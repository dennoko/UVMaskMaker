# UV Mask Maker 使い方（Unity 2022.3）

このドキュメントは、`Tools > UV Mask Maker` で開くエディタ拡張の使い方を日本語で説明します。選択した UV アイランドを黒、その他を白として出力するマスク画像を簡単に作成できます。

---

## 準備
- Unity 2022.3 LTS 以降
- 対象メッシュは Read/Write 有効（インポート設定）
- UV0 が必要（本ツールは UV0 を使用）

---

## 基本手順
1. メニューから `Tools > UV Mask Maker` を開く
2. ウィンドウ上部の枠に対象 GameObject をドラッグ＆ドロップ（または Object フィールドで指定）
3. `Analyze UVs` をクリックして UV の解析を実行
4. シーンビューで対象をクリックしてアイランドを選択
   - トグルホットキーに設定されたキーを押すと選択/解除が切り替わります
5. `Pixel Margin` を必要に応じて調整（塗りつぶす境界を外側に膨らませる）
6. `Size` と `File Name`、`Output Dir` を確認し、`Save PNG` でマスクを書き出し
7. （任意）チャンネル別出力/頂点カラー焼き込み: トグルをONにすると設定が表示され、RGBA から書き込むチャネルを選択して PNG または頂点カラーへ反映できます

---

## 画面構成と各オプション

### 対象オブジェクト
- Object: 対象 GameObject の指定欄
- Clear: 対象解除

### Use Baked Mesh
- Objectのスケールやボーンの変形に合わせてデータを更新します
- ON推奨です

### 操作モード / ホットキー
- Add / Remove（ツールバー）: 選択動作の切り替え
- トグルホットキー: 選択モード切替に使うキー（任意に変更可能）

### Scene Overlay（シーン表示）
- UVチャンネル：使用するUV（UV0..UV7）を選択。変更時に自動で再解析が走ります
- 最前面に描画（X-Ray）：分割線/ワイヤーを常に手前に表示（Zテスト無効）
- アンチエイリアスを無効化（高速）：AAなしの1px線で高速描画。太さはAA有効時のみ反映
- バックフェース抑制（選択表示）：カメラから見て背面の三角形のワイヤーを非表示にして見やすくします

詳細オプション（フォールドアウト）
- 太さ：シーンビューのライン太さ（AA有効時に有効）
- デプスオフセット（mm）：法線方向へ押し出してZファイティングを回避

### 選択操作
- Analyze UVs: UV 解析を実行（アイランドとシームを再計算）
- Invert: 選択の反転
- Select All: すべて選択
- Clear: 選択解除

### プレビュー
- プレビューにベーステクスチャを重ねる：マスクのプレビューの下にベーステクスチャを表示します
- ピクセルマージン: 膨張ピクセル数（0–16）。数値を上げると黒領域が外側に増えます※マスクしている領域がわずかに足りない時に領域を広げるために使用します
- UVアイランド境界をプレビュー表示（デバッグ）：プレビュー上にUVアイランドの境界線を重ねて表示します
- マスク反転（Union結果を反転）：最終マスクの黒白を反転します。反転が有効な場合、マージンの膨張は「白側」を拡張するため、元の選択アイランド（黒）が侵食されません

### Export（書き出し）
- 解像度： 出力サイズ（512 / 1024 / 2048 / 4096）
- ファイル名： 出力ファイル名（拡張子は .png）※デフォルトの名前は、オブジェクト名_mask
- 出力フォルダ： 出力フォルダ（`Assets/` 配下の相対パス）。`Browse` で選択 ※デフォルトはAssets/GeneratedMasks
- PNGを保存： マスクを PNG で保存し、プロジェクトにインポート

### チャンネル別書き込み（PNG/頂点カラー）
- 有効：有効状態を切り替えます
- RGBA: チェックしたチャネルのみを書き込みます
- ベースPNG: 既存PNGに上書きする場合に指定（未指定なら新規PNGに書き込み）。非選択チャネルは温存
- ベースメッシュ（頂点カラー）: 頂点カラー上書きのベースにするメッシュを指定（頂点数一致が必要）。一致しない場合は対象メッシュの頂点カラーをベースに使用
- 頂点カラーへの書き込み: 選択三角形の頂点に対し、選択したチャネルのみ 0/255 を上書き。非選択頂点・非選択チャネルは保持
- 保存先: 頂点カラーメッシュは元メッシュ横の `VertexColorMasks/` フォルダに自動保存（存在しなければ作成）
- 同名上書き: 頂点カラーメッシュ保存時の上書き可否を指定。無効時は重複しない名前で保存

---


## トラブルシューティング
- シームが見えない: UV0 があるか、Read/Write が有効かを確認
- クリックで選択されない: 対象が視界にあるか、衝突できるかを確認（内部で `__UVMaskPickerCollider__` を使用）
- スキンメッシュで位置ズレ: `Use Baked Mesh` をオン（現在のポーズは自動ベイクされます）
- ログ: `Assets/Editor/UVMaskMakerLogs/uv_mask_maker.log`

- Use Baked MeshをONにし、Analyze UVsを実行しても表示位置が合わない場合、なんらかのコンポーネントによる本ツールの対象外のメッシュ変形が行われてい可能性があります。マスク作成に影響がある場合は、対象のオブジェクトが参照しているFBXをシーンに配置し、それを元にマスクを作成してください。
